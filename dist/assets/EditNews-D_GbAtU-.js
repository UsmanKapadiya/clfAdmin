import{b as P,u as E,r as a,y,j as e}from"./index-BkylyDC8.js";import{R as L}from"./quill.snow-Id8ky7ku.js";import{D as T}from"./DashboardLayout-CUVQyk-J.js";import{c as _,u as B,a as R}from"./newsApi-CbAtU5oq.js";import"./logo-DBYIBsYi.js";const V=()=>{const{id:g}=P(),f=E(),u=g==="new",[p,m]=a.useState(!1),[x,n]=a.useState(""),[N,w]=a.useState(""),[b,k]=a.useState(!1),[t,h]=a.useState({id:"",title:"",description:"",date:"",slug:""});a.useEffect(()=>{u||(async()=>{m(!0),n("");try{const s=await R(g);if(s.success&&s.data){const l=s.data.data||s.data;h({id:l._id,title:l.title,description:l.description,date:l.date,slug:l.slug})}else n(s.error||"News item not found")}catch{n("News item not found")}finally{m(!1)}})()},[g,u]);const o=a.useCallback(()=>{n(""),w("")},[]),v=a.useCallback(r=>r.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),[]),C=a.useCallback(r=>{const{name:s,value:l}=r.target;h(i=>{const c={...i,[s]:l};return s==="title"&&(c.slug=v(l)),c}),o()},[o,v]),S=a.useCallback(r=>{h(s=>({...s,description:r})),o()},[o]),D=a.useCallback(r=>{const s=r.target.value,i=new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}).toUpperCase();h(c=>({...c,date:i})),o()},[o]),j=a.useCallback(()=>{const r=[{field:"title",message:"Title is required"},{field:"description",message:"Description is required"},{field:"date",message:"Date is required"},{field:"slug",message:"Slug is required"}];for(const{field:s,message:l}of r){const i=t[s];if(!i||typeof i=="string"&&!i.trim())return n(l),!1}return/^[a-z0-9-]+$/.test(t.slug)?!0:(n("Slug can only contain lowercase letters, numbers, and hyphens"),!1)},[t]),q=a.useCallback(async r=>{var s,l,i,c;if(r.preventDefault(),!!j()){m(!0),o();try{let d;u?d=await _(t):d=await B(t.id||t._id,t),d.success?(w(((s=d.data)==null?void 0:s.message)||"Item saved successfully!"),y.success(((l=d.data)==null?void 0:l.message)||"Item saved successfully!"),setTimeout(()=>f("/news"),1500)):(n(((i=d.data)==null?void 0:i.error)||"Failed to save item. Please try again."),y.error(((c=d.data)==null?void 0:c.error)||"Failed to save item. Please try again."),m(!1))}catch{n("Failed to save item. Please try again."),m(!1)}}},[t,j,o,f]),I=a.useCallback(()=>{f("/news")},[f]),F=a.useCallback(()=>{if(!t.date)return"";try{return new Date(t.date).toISOString().split("T")[0]}catch{return""}},[t.date]);return e.jsx(T,{children:e.jsx("div",{className:"edit-news-page",children:e.jsxs("div",{className:"edit-form-card",children:[e.jsxs("div",{className:"edit-form-header",children:[e.jsx("h1",{className:"edit-form-title",children:u?"Add News Item":"Edit News Item"}),e.jsx("p",{className:"edit-form-subtitle",children:u?"Create a new news announcement or event":`Editing: ${t.title||"Loading..."}`})]}),x&&e.jsx("div",{className:"error-banner",children:x}),N&&e.jsx("div",{className:"success-banner",children:N}),e.jsxs("form",{onSubmit:q,className:"edit-form",children:[e.jsxs("div",{className:"form-group form-group-full",children:[e.jsx("label",{htmlFor:"title",className:"form-label form-label-required",children:"Title"}),e.jsx("input",{type:"text",id:"title",name:"title",className:"form-input",placeholder:"Enter news title",value:t.title,onChange:C,required:!0}),e.jsx("p",{className:"form-help-text",children:"The main headline of the news item"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",className:"form-label form-label-required",children:"Date"}),e.jsx("input",{type:"date",id:"date",name:"date",className:"form-input",value:F(),onChange:D,required:!0}),e.jsx("p",{className:"form-help-text",children:"Publication date of the news item"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"slug",className:"form-label form-label-required",children:"Slug"}),e.jsx("input",{type:"text",id:"slug",name:"slug",className:"form-input",placeholder:"url-friendly-slug",value:t.slug,disabled:!0,readOnly:!0,required:!0}),e.jsx("p",{className:"form-help-text",children:"Auto-generated from title (lowercase, hyphens only)"})]})]}),e.jsxs("div",{className:"form-group form-group-full",children:[e.jsx("label",{htmlFor:"description",className:"form-label form-label-required",children:"Description"}),e.jsx("div",{className:"editor-wrapper",children:e.jsx(L,{theme:"snow",value:t.description||"",onChange:S,modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["blockquote","code-block"],[{indent:"-1"},{indent:"+1"}],["clean"]]},formats:["header","bold","italic","underline","strike","color","background","list","bullet","align","link","image","blockquote","code-block","indent"],style:{height:"300px"}})}),e.jsx("p",{className:"form-help-text",children:"Use the toolbar to format text, add links, images, and more."}),t.description&&t.description.trim()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"preview-toggle",onClick:()=>k(!b),children:b?"Hide Preview":"Show Preview"}),b&&e.jsx("div",{className:"html-preview",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:t.description}})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:I,disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-save",disabled:p,children:p?"Saving...":"Save News Item"})]})]})]})})})};export{V as default};
