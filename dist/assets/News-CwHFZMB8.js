import{j as s,u as z,r as a,y as S}from"./index-BkylyDC8.js";import{d as l,r as H}from"./relativeTime-DTi7sQsR.js";import{c as V,D as Y}from"./DashboardLayout-CUVQyk-J.js";import{E as F,A as B,G,C as R}from"./GlobalLoader-DTVyf5T6.js";import{d as U,g as k}from"./newsApi-CbAtU5oq.js";import{D as q}from"./Delete-BoIrEoUI.js";import{P as J}from"./Pagination-iGbDK-jx.js";import"./logo-DBYIBsYi.js";const K=V(s.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}));l.extend(H);const le=()=>{const u=z(),[x,A]=a.useState([]),[i,N]=a.useState(""),[h,p]=a.useState(1),[w]=a.useState(10),[c,o]=a.useState({isOpen:!1,itemId:null,itemName:""}),[d,g]=a.useState([]),[E,r]=a.useState(!0),[j,f]=a.useState(null),[v,L]=a.useState(1),[Q,P]=a.useState(0);a.useEffect(()=>{(async()=>{var n,m,D;r(!0),f(null);const t=await k(h,w);t.success?(g(((n=t.data)==null?void 0:n.data)||[]),L(((m=t.data)==null?void 0:m.totalpages)||1),P(((D=t.data)==null?void 0:D.length)||0)):f(t.error||"Failed to fetch news"),r(!1)})()},[h,w]);const C=a.useMemo(()=>{if(!i.trim())return d;const e=i.toLowerCase();return d.filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.date&&t.date.toLowerCase().includes(e))},[i,d]),T=a.useCallback(e=>{N(e.target.value),p(1)},[]),_=a.useCallback((e,t)=>{p(t),window.scrollTo({top:0,behavior:"smooth"})},[]),b=a.useCallback(e=>{A(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])},[]),I=a.useCallback((e,t)=>{t.stopPropagation(),u(`/news/edit/${e}`)},[u]),y=a.useCallback((e,t)=>{t.stopPropagation();const n=d.find(m=>m.id===e);o({isOpen:!0,itemId:e,itemName:(n==null?void 0:n.title)||"this news item"})},[d]),M=a.useCallback(async()=>{var t;if(!c.itemId)return;r(!0);const e=await U(c.itemId);if(e.success){const n=await k();n.success&&g(((t=n.data)==null?void 0:t.data)||[]),o({isOpen:!1,itemId:null,itemName:""}),S.success("News item deleted successfully!")}else o({isOpen:!1,itemId:null,itemName:""}),S.error(e.error||"Failed to delete news item");r(!1)},[c.itemId]),O=a.useCallback(()=>{o({isOpen:!1,itemId:null,itemName:""})},[]),$=a.useCallback(e=>{const t=x.includes(e._id);return s.jsx("div",{className:"news-item-wrapper",children:s.jsxs("div",{className:"news-item",onClick:()=>b(e._id),children:[s.jsxs("div",{className:"news-item-header",children:[s.jsxs("div",{className:"news-item-info",children:[s.jsx("div",{className:"news-item-title",children:e.title}),s.jsxs("div",{className:"news-item-date",children:[s.jsx("span",{className:"date-badge",children:l(e.date).isValid()?l(e.date).format("DD-MMM-YYYY"):e.date}),s.jsx("span",{className:"date-badge",children:e.updatedAt&&l(e.updatedAt).isValid()?`Updated ${l(e.updatedAt).fromNow()}`:e.createdAt&&l(e.createdAt).isValid()?`Created ${l(e.createdAt).fromNow()}`:""})]})]}),s.jsxs("div",{className:"news-item-actions",children:[s.jsx("button",{className:"btn-icon edit",onClick:n=>I(e._id,n),title:"Edit","aria-label":`Edit ${e.title}`,children:s.jsx(F,{})}),s.jsx("button",{className:"btn-icon delete",onClick:n=>y(e._id,n),title:"Delete","aria-label":`Delete ${e.title}`,children:s.jsx(q,{})})]})]}),t&&s.jsx("div",{className:"news-item-description",children:s.jsx("div",{dangerouslySetInnerHTML:{__html:e.description}})})]})},e._id)},[x,b,I,y]);return s.jsx(Y,{children:s.jsxs("div",{className:"news-page",children:[s.jsx("div",{className:"page-header",children:s.jsxs("div",{className:"news-header",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"page-title",children:"News"}),s.jsx("p",{className:"page-subtitle",children:"Manage announcements and upcoming events"})]}),s.jsx("div",{className:"news-actions",children:s.jsxs("button",{className:"btn-add",onClick:()=>u("/news/edit/new"),children:[s.jsx(B,{}),"Add News Item"]})})]})}),s.jsxs("div",{className:"search-bar",children:[s.jsx("input",{type:"text",placeholder:"Search news by title, description, or date...",value:i,onChange:T,className:"search-input"}),i&&s.jsx("button",{className:"clear-search",onClick:()=>{N(""),p(1)},"aria-label":"Clear search",children:"Ã—"})]}),s.jsxs("div",{className:"news-list",children:[E&&s.jsx(G,{text:"Loading..."}),j?s.jsx("div",{className:"empty-state",children:j}):C.length>0?C.map(e=>s.jsx("div",{children:$(e)},e._id)):s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-state-icon",children:s.jsx(K,{style:{fontSize:48}})}),s.jsx("div",{className:"empty-state-text",children:i?"No news items found":"No news items yet"})]})]}),v>1&&s.jsx("div",{className:"pagination-container",children:s.jsx(J,{count:v,page:h,onChange:_,color:"primary",size:"large",showFirstButton:!0,showLastButton:!0})}),s.jsx(R,{isOpen:c.isOpen,onClose:O,onConfirm:M,title:"Delete News Item",message:`Are you sure you want to delete "${c.itemName}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",type:"danger"})]})})};export{le as default};
