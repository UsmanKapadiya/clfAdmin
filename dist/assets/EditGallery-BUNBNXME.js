import{j as e,b as F,u as D,r as o,y as f}from"./index-BkylyDC8.js";import{c as U,D as q}from"./DashboardLayout-CUVQyk-J.js";import{c as R,e as E,u as G}from"./galleryApi-CGkPiNuK.js";import{D as I}from"./Delete-BoIrEoUI.js";import"./logo-DBYIBsYi.js";const x=U(e.jsx("path",{d:"M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8zM5 19l3-4 2 3 3-4 4 5z"})),V=()=>{const{id:g}=F(),h=D(),d=g==="new",[b,u]=o.useState(!1),[y,r]=o.useState(""),[j,T]=o.useState(""),[s,c]=o.useState({id:"",title:"",year:new Date().getFullYear().toString(),subTitle:"",catalogThumbnail:"",photos:[]});o.useEffect(()=>{d||(u(!0),r(""),R(g).then(l=>{var t;if(l.success&&l.data){const a=(t=l.data)==null?void 0:t.data;console.log(a),c({id:a._id,title:a.title,year:a.year,subTitle:a.subTitle,catalogThumbnail:a.catalogThumbnail,photos:a.photos||[]})}else r(l.error||"Gallery not found")}).catch(()=>r("Gallery not found")).finally(()=>u(!1)))},[g,d]);const m=o.useCallback(()=>{r(""),T("")},[]),p=o.useCallback(l=>{const{name:t,value:a}=l.target;c(i=>({...i,[t]:a})),m()},[m]),C=o.useCallback(()=>{const l=document.createElement("input");l.type="file",l.accept="image/*",l.multiple=!0,l.onchange=async t=>{const a=Array.from(t.target.files);if(a.length>0){const i=a.map((n,S)=>({id:Date.now()+S,src:URL.createObjectURL(n),file:n}));c(n=>({...n,photos:[...n.photos,...i]}))}},l.click()},[]),v=o.useCallback(l=>{const t=l.map((a,i)=>({id:Date.now()+i,src:a.trim()})).filter(a=>a.src);c(a=>({...a,photos:[...a.photos,...t]}))},[]);o.useCallback((l,t)=>{c(a=>({...a,photos:a.photos.map(i=>i.id===l?{...i,src:t}:i)})),m()},[m]);const k=o.useCallback(l=>{const t=l.split(`
`).map(a=>a.trim()).filter(a=>a);t.length>0&&v(t)},[v]),P=o.useCallback(l=>{c(t=>({...t,photos:t.photos.filter(a=>a.id!==l)}))},[]),N=o.useCallback(()=>{const l=[{field:"title",message:"Title is required"},{field:"year",message:"Year is required"},{field:"subTitle",message:"Location/Subtitle is required"},{field:"catalogThumbnail",message:"Catalog thumbnail URL is required"}];for(const{field:t,message:a}of l){const i=s[t];if(t==="catalogThumbnail"){if(!i||typeof i=="string"&&!i.trim()||typeof i=="object"&&!i.file)return r(a),!1}else if(!i||typeof i=="string"&&!i.trim())return r(a),!1}if(s.photos.length===0)return r("Please add at least one photo"),!1;for(let t=0;t<s.photos.length;t++){const a=s.photos[t];if(!a.src||!a.src.trim())return r(`Photo ${t+1}: Image URL is required`),!1}return!0},[s]),w=o.useCallback(async l=>{if(l.preventDefault(),!!N()){u(!0),m();try{const t=new FormData;t.append("id",s.id),t.append("title",s.title),t.append("year",s.year),t.append("subTitle",s.subTitle),s.catalogThumbnail&&typeof s.catalogThumbnail=="object"&&s.catalogThumbnail.file?t.append("catalogThumbnail",s.catalogThumbnail.file):s.catalogThumbnail&&t.append("catalogThumbnail",s.catalogThumbnail),s.catalogThumbnail instanceof File?t.append("catalogThumbnail",s.catalogThumbnail):s.catalogThumbnail&&typeof s.catalogThumbnail=="object"&&s.catalogThumbnail.file?t.append("catalogThumbnail",s.catalogThumbnail.file):s.catalogThumbnail&&t.append("catalogThumbnail",s.catalogThumbnail),s.photos.forEach((i,n)=>{i.file?t.append("photos",i.file):i.src&&t.append("photoUrls",i.src)});let a;d?a=await E(t,s.id):a=await G(s.id,t),a.success?(f.success("Gallery saved successfully!"),h("/gallery")):(r(a.error||"Failed to save gallery. Please try again."),f.error(a.error||"Failed to save gallery. Please try again."))}catch{r("Failed to save gallery. Please try again."),f.error("Failed to save gallery. Please try again.")}finally{u(!1)}}},[s,N,m,h,d]),L=o.useCallback(()=>{h("/gallery")},[h]);return e.jsx(q,{children:e.jsx("div",{className:"edit-gallery-page",children:e.jsxs("div",{className:"edit-form-card",children:[e.jsxs("div",{className:"edit-form-header",children:[e.jsx("h1",{className:"edit-form-title",children:d?"Add Gallery":"Edit Gallery"}),e.jsx("p",{className:"edit-form-subtitle",children:d?"Create a new photo gallery":`Editing: ${s.title||"Loading..."}`})]}),y&&e.jsx("div",{className:"error-banner",children:y}),j&&e.jsx("div",{className:"success-banner",children:j}),e.jsxs("form",{onSubmit:w,className:"edit-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",className:"form-label form-label-required",children:"Gallery Title"}),e.jsx("input",{type:"text",id:"title",name:"title",className:"form-input",placeholder:"e.g., 2025 Annual BBQ",value:s.title,onChange:p,required:!0}),e.jsx("p",{className:"form-help-text",children:"Main title of the gallery"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"year",className:"form-label form-label-required",children:"Year"}),e.jsx("select",{id:"year",name:"year",className:"form-input",value:s.year,onChange:p,required:!0,children:Array.from({length:50},(l,t)=>new Date().getFullYear()-t).map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsx("p",{className:"form-help-text",children:"Year of the event"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subTitle",className:"form-label form-label-required",children:"Location/Subtitle"}),e.jsx("input",{type:"text",id:"subTitle",name:"subTitle",className:"form-input",placeholder:"e.g., Richmond",value:s.subTitle,onChange:p,required:!0}),e.jsx("p",{className:"form-help-text",children:"Location or subtitle for the gallery"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"catalogThumbnail",className:"form-label form-label-required",children:"Catalog Thumbnail"}),e.jsxs("div",{className:"thumbnail-upload-section",children:[e.jsx("input",{type:"url",id:"catalogThumbnail",name:"catalogThumbnail",className:"form-input",placeholder:"https://example.com/image.jpg or upload image",value:typeof s.catalogThumbnail=="string"?s.catalogThumbnail:"",onChange:p}),e.jsxs("button",{type:"button",className:"btn-upload-thumbnail",onClick:()=>{const l=document.createElement("input");l.type="file",l.accept="image/*",l.onchange=t=>{const a=t.target.files[0];if(a){const i=URL.createObjectURL(a);c(n=>({...n,catalogThumbnail:{src:i,file:a}}))}},l.click()},children:[e.jsx(x,{}),"Upload"]})]}),e.jsx("p",{className:"form-help-text",children:"Main thumbnail for gallery catalog"})]})]}),s.catalogThumbnail&&e.jsxs("div",{className:"thumbnail-preview",children:[e.jsx("label",{className:"form-label",children:"Thumbnail Preview:"}),e.jsx("img",{src:typeof s.catalogThumbnail=="string"?s.catalogThumbnail:s.catalogThumbnail.src,alt:"Catalog thumbnail preview",onError:l=>l.target.style.display="none",onLoad:l=>l.target.style.display="block"})]}),e.jsxs("div",{className:"photos-section",children:[e.jsxs("div",{className:"photos-header",children:[e.jsxs("label",{className:"form-label form-label-required",children:["Photos (",s.photos.length,")"]}),e.jsx("div",{className:"photo-actions",children:e.jsxs("button",{type:"button",className:"btn-add-photo",onClick:C,children:[e.jsx(x,{}),"Upload Images"]})})]}),e.jsxs("div",{className:"bulk-upload-section",children:[e.jsx("label",{className:"form-label",children:"Add Multiple Photos (Paste URLs)"}),e.jsx("textarea",{className:"bulk-input",placeholder:`Paste image URLs here (one per line)
https://example.com/image1.jpg
https://example.com/image2.jpg
https://example.com/image3.jpg`,rows:"5",onPaste:l=>{setTimeout(()=>{k(l.target.value),l.target.value=""},100)}}),e.jsx("p",{className:"form-help-text",children:"Paste multiple image URLs (one per line) and they will be added automatically"})]}),s.photos.length===0?e.jsxs("div",{className:"no-photos",children:[e.jsx(x,{style:{fontSize:48,color:"#ccc"}}),e.jsx("p",{children:"No photos added yet"}),e.jsx("p",{className:"help-text",children:"Add single photos or paste multiple URLs above"})]}):e.jsx("div",{className:"photos-grid",children:s.photos.map((l,t)=>e.jsxs("div",{className:"photo-card",children:[e.jsxs("div",{className:"photo-card-header",children:[e.jsxs("span",{className:"photo-number",children:["#",t+1]}),e.jsx("button",{type:"button",className:"btn-delete-photo",onClick:()=>P(l.id),title:"Delete photo",children:e.jsx(I,{})})]}),l.src&&e.jsxs("div",{className:"photo-preview",children:[e.jsx("img",{src:l.src,alt:`Photo ${t+1}`,onError:a=>{a.target.style.display="none",a.target.nextSibling.style.display="flex"},onLoad:a=>{a.target.style.display="block",a.target.nextSibling.style.display="none"}}),e.jsx("div",{className:"image-error",style:{display:"none"},children:e.jsx("span",{children:"‚ùå Invalid URL"})})]})]},l.id))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:L,disabled:b,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-save",disabled:b,children:b?"Saving...":"Save Gallery"})]})]})]})})})};export{V as default};
