import{j as s,u as le,r as l,R as N,y as C}from"./index-BkylyDC8.js";import{A as z,G as ie,E as F,a as Y,C as oe}from"./GlobalLoader-DTVyf5T6.js";import{c as U,D as ne,P as B}from"./DashboardLayout-CUVQyk-J.js";import{d as re,a as ce,g as _,b as q}from"./galleryApi-CGkPiNuK.js";import{D as K}from"./Delete-BoIrEoUI.js";import{V as D}from"./VideoLibrary-KcSjoIla.js";import{P as de}from"./Pagination-iGbDK-jx.js";import"./logo-DBYIBsYi.js";const he=U(s.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),ue=U(s.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),Ne=()=>{const u=le(),[c,O]=l.useState(""),[o,T]=l.useState("photos"),[d,W]=l.useState("all"),[k,p]=l.useState(1),[y]=l.useState(12),[h,m]=l.useState({isOpen:!1,itemId:null,itemName:""}),[r,j]=l.useState({isOpen:!1,images:[],currentIndex:0}),[n,E]=l.useState([]),[b,V]=l.useState([]),[H,x]=l.useState(!0),[me,I]=l.useState(null),[$,w]=l.useState({open:!1,url:""});N.useEffect(()=>{(async()=>{var t,a;if(x(!0),I(null),o==="photos"){const i=await _();if(i.success){let S=((t=i.data)==null?void 0:t.data)||i.data;E(S)}else I(i.error||"Failed to fetch gallery")}else{const i=await q();if(i.success){let S=((a=i.data)==null?void 0:a.data)||i.data;V(S)}else I(i.error||"Failed to fetch video gallery")}x(!1)})()},[o]);const g=N.useMemo(()=>o==="photos"?!n||typeof n!="object"?[]:Object.values(n).flat():!b||typeof b!="object"?[]:Object.values(b).flat(),[n,b,o]),J=N.useMemo(()=>o!=="photos"?[]:!n||typeof n!="object"||Array.isArray(n)?[]:Object.keys(n).filter(t=>typeof t=="string").sort((t,a)=>a.localeCompare(t)),[n,o]),f=l.useMemo(()=>{let e=g;if(d!=="all"&&(e=e.filter(t=>t.year===d)),c.trim()){const t=c.toLowerCase();e=e.filter(a=>a.title.toLowerCase().includes(t)||a.subTitle.toLowerCase().includes(t)||a.year.includes(t))}return e.sort((t,a)=>{var i;return(i=a.year)==null?void 0:i.localeCompare(t.year)})},[c,d,g]),A=Math.ceil(f.length/y),M=l.useMemo(()=>{const e=(k-1)*y,t=e+y;return f.slice(e,t)},[f,k,y]),Q=l.useCallback(e=>{O(e.target.value),p(1)},[]),R=l.useCallback(e=>{W(e),p(1)},[]),X=l.useCallback((e,t)=>{p(t),window.scrollTo({top:0,behavior:"smooth"})},[]),Z=l.useCallback((e,t)=>{t.stopPropagation(),u(`/gallery/edit/${e}`)},[u]),ee=l.useCallback((e,t)=>{t.stopPropagation();const a=g.find(i=>i.id===e);m({isOpen:!0,itemId:e,itemName:(a==null?void 0:a.title)||"this gallery"})},[g]),se=l.useCallback(async()=>{var t,a;if(!h.itemId)return;x(!0);let e;if(o==="photos"?(e=await re(h.itemId),x(!1),m({isOpen:!1,itemId:null,itemName:""}),e&&e.success?C.success("Gallery deleted successfully!"):C.error((e==null?void 0:e.error)||"Failed to delete gallery. Please try again.")):(e=await ce(h.itemId),x(!1),m({isOpen:!1,itemId:null,itemName:""}),e&&e.success?C.success("Video deleted successfully!"):C.error((e==null?void 0:e.error)||"Failed to delete video. Please try again.")),o==="photos"){const i=await _();E(i.success?((t=i.data)==null?void 0:t.data)||i.data:[])}else{const i=await q();V(i.success?((a=i.data)==null?void 0:a.data)||i.data:[])}},[h.itemId,o]),te=l.useCallback(()=>{m({isOpen:!1,itemId:null,itemName:""})},[]),ae=l.useCallback(e=>{const t=e.photos.map(a=>a.src);j({isOpen:!0,images:t,currentIndex:0})},[]),v=l.useCallback(()=>{j({isOpen:!1,images:[],currentIndex:0})},[]),L=l.useCallback(()=>{j(e=>({...e,currentIndex:e.currentIndex>0?e.currentIndex-1:e.images.length-1}))},[]),P=l.useCallback(()=>{j(e=>({...e,currentIndex:e.currentIndex<e.images.length-1?e.currentIndex+1:0}))},[]),G=l.useCallback(e=>{r.isOpen&&(e.key==="Escape"&&v(),e.key==="ArrowLeft"&&L(),e.key==="ArrowRight"&&P())},[r.isOpen,v,L,P]);return N.useEffect(()=>(window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)),[G]),console.log("galleryList",n),s.jsx(ne,{children:s.jsxs("div",{className:"gallery-page",children:[s.jsxs("div",{className:"gallery-type-toggle",style:{display:"flex",gap:12,marginBottom:24},children:[s.jsxs("button",{className:`btn-add gallery-type-btn${o==="photos"?" active":""}`,onClick:()=>T("photos"),type:"button",children:[s.jsx(z,{style:{marginRight:6}}),"Photos Gallery"]}),s.jsxs("button",{className:`btn-add gallery-type-btn${o==="videos"?" active":""}`,onClick:()=>T("videos"),type:"button",children:[s.jsx(D,{style:{marginRight:6}}),"Video Gallery"]})]}),s.jsx("div",{className:"page-header",children:s.jsxs("div",{className:"gallery-header",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"page-title",children:"Gallery"}),s.jsx("p",{className:"page-subtitle",children:"Manage photo galleries and albums"})]}),s.jsx("div",{className:"gallery-actions",children:o==="photos"?s.jsxs("button",{className:"btn-add",onClick:()=>u("/gallery/edit/new"),children:[s.jsx(z,{}),"Add Gallery"]}):s.jsxs("button",{className:"btn-add",onClick:()=>u("/gallery/videos/edit/new"),children:[s.jsx(D,{}),"Add Video Gallery"]})})]})}),s.jsxs("div",{className:"gallery-filters",children:[s.jsxs("div",{className:"search-bar",children:[s.jsx("input",{type:"text",placeholder:"Search galleries by title, location, or year...",value:c,onChange:Q,className:"search-input"}),c&&s.jsx("button",{className:"clear-search",onClick:()=>{O(""),p(1)},"aria-label":"Clear search",children:"Ã—"})]}),o==="photos"&&s.jsxs("div",{className:"year-filter-tabs",children:[s.jsxs("button",{className:`year-tab ${d==="all"?"active":""}`,onClick:()=>R("all"),children:["All Years (",g.length,")"]}),J.map(e=>{const t=n&&n[e]?n[e].length:0;return s.jsxs("button",{className:`year-tab ${d===e?"active":""}`,onClick:()=>R(e),children:[e," (",t,")"]},e)})]})]}),H?s.jsx(ie,{text:"Loading..."}):s.jsx("div",{className:"gallery-grid",children:M.length>0?M.map(e=>{var t;return o==="photos"?s.jsxs("div",{className:"gallery-card",children:[s.jsxs("div",{className:"gallery-thumbnail",onClick:()=>ae(e),children:[s.jsx("img",{src:e.catalogThumbnail,alt:e.title,loading:"lazy"}),s.jsx("div",{className:"gallery-overlay",children:s.jsxs("div",{className:"photo-count",children:[s.jsx(B,{}),s.jsxs("span",{children:[(t=e==null?void 0:e.photos)==null?void 0:t.length," Photos"]})]})})]}),s.jsxs("div",{className:"gallery-info",children:[s.jsxs("div",{className:"gallery-details",children:[s.jsx("h3",{className:"gallery-title",children:e.title}),s.jsx("p",{className:"gallery-subtitle",children:e.subTitle}),s.jsx("span",{className:"gallery-year",children:e.year})]}),s.jsxs("div",{className:"gallery-card-actions",children:[s.jsx("button",{className:"btn-icon edit",onClick:a=>Z(e._id,a),title:"Edit","aria-label":`Edit ${e.title}`,children:s.jsx(F,{})}),s.jsx("button",{className:"btn-icon delete",onClick:a=>ee(e.id,a),title:"Delete","aria-label":`Delete ${e.title}`,children:s.jsx(K,{})})]})]})]},e.id):s.jsxs("div",{className:"gallery-card video-card",children:[s.jsxs("div",{className:"gallery-thumbnail",onClick:()=>w({open:!0,url:e.videoUrl}),style:{cursor:"pointer"},children:[s.jsx("img",{src:e.catalogThumbnail,alt:e.title,loading:"lazy"}),s.jsx("div",{className:"gallery-overlay",children:s.jsxs("div",{className:"photo-count",children:[s.jsx(D,{}),s.jsx("span",{children:"Video"})]})})]}),s.jsxs("div",{className:"gallery-info",children:[s.jsx("div",{className:"gallery-details",children:s.jsx("h3",{className:"gallery-title",children:e.title})}),s.jsxs("div",{className:"gallery-card-actions",children:[s.jsx("button",{className:"btn-icon edit",onClick:a=>{a.stopPropagation(),u(`/gallery/videos/edit/${e._id}`)},title:"Edit","aria-label":`Edit ${e.title}`,children:s.jsx(F,{})}),s.jsx("button",{className:"btn-icon delete",onClick:a=>{a.stopPropagation(),m({isOpen:!0,itemId:e._id,itemName:e.title||"this video"})},title:"Delete","aria-label":`Delete ${e.title}`,children:s.jsx(K,{})})]})]})]},e.id)}):s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-state-icon",children:s.jsx(B,{style:{fontSize:48}})}),s.jsx("div",{className:"empty-state-text",children:c||d!=="all"?"No galleries found":"No galleries yet"}),s.jsx("div",{className:"empty-state-subtext",children:c||d!=="all"?"Try adjusting your filters":"Add your first gallery to get started"})]})}),$.open&&s.jsxs("div",{className:"lightbox-overlay",onClick:()=>w({open:!1,url:""}),children:[s.jsx("button",{className:"lightbox-close",onClick:()=>w({open:!1,url:""}),children:s.jsx(Y,{})}),s.jsx("div",{className:"lightbox-content",style:{width:"90vw",maxWidth:800,background:"#000",padding:16},onClick:e=>e.stopPropagation(),children:s.jsx("iframe",{width:"100%",height:"450",src:$.url,title:"Video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{borderRadius:8}})})]}),f.length>0&&A>1&&s.jsx("div",{className:"pagination-container",children:s.jsx(de,{count:A,page:k,onChange:X,color:"primary",size:"large",showFirstButton:!0,showLastButton:!0})}),s.jsx(oe,{isOpen:h.isOpen,onClose:te,onConfirm:se,title:"Delete Gallery",message:`Are you sure you want to delete "${h.itemName}"? This will also delete all photos in this gallery. This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",type:"danger"}),r.isOpen&&s.jsxs("div",{className:"lightbox-overlay",onClick:v,children:[s.jsx("button",{className:"lightbox-close",onClick:v,children:s.jsx(Y,{})}),s.jsx("button",{className:"lightbox-nav lightbox-prev",onClick:e=>{e.stopPropagation(),L()},children:s.jsx(he,{})}),s.jsx("button",{className:"lightbox-nav lightbox-next",onClick:e=>{e.stopPropagation(),P()},children:s.jsx(ue,{})}),s.jsxs("div",{className:"lightbox-content",onClick:e=>e.stopPropagation(),children:[s.jsx("img",{src:r.images[r.currentIndex],alt:`Photo ${r.currentIndex+1}`}),s.jsxs("div",{className:"lightbox-counter",children:[r.currentIndex+1," / ",r.images.length]})]})]})]})})};export{Ne as default};
