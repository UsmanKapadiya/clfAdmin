const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/aboutApi-8cmP2KYY.js","assets/index-BkylyDC8.js","assets/index-DNizovks.css"])))=>i.map(i=>d[i]);
import{b as H,u as U,r,y as I,j as e,_ as G}from"./index-BkylyDC8.js";import{R as Q}from"./quill.snow-Id8ky7ku.js";import{D as V}from"./DashboardLayout-CUVQyk-J.js";import{createAbout as $,updateAbout as z,getAboutById as J}from"./aboutApi-8cmP2KYY.js";import"./logo-DBYIBsYi.js";const q=["style","biography"],ee=()=>{const{id:j}=H(),b=U(),p=j==="new",[v,g]=r.useState(!1),[_,o]=r.useState(""),[k,S]=r.useState(""),[N,F]=r.useState(!1),[n,f]=r.useState(""),[D,x]=r.useState(!1),[a,h]=r.useState({_id:"",name:"",title:"",category:"",description:"",parent_id:null}),[c,L]=r.useState([]);r.useEffect(()=>{(async()=>{var l,i;const t=await G(()=>import("./aboutApi-8cmP2KYY.js"),__vite__mapDeps([0,1,2])).then(d=>d.getAboutList());t.success&&Array.isArray((l=t.data)==null?void 0:l.data)&&L((i=t.data)==null?void 0:i.data)})()},[]);const y=r.useMemo(()=>{const s=[...new Set(c.map(t=>t.category))];return[...q.filter(t=>s.includes(t)),...s.filter(t=>!q.includes(t))]},[c]),P=r.useMemo(()=>{const s=a.category||n;return c.filter(t=>t.parent_id===null&&t._id!==a.id&&t._id!==a.parent_id&&(!s||t.category===s))},[c,a._id,a.parent_id,a.category,n]),C=r.useMemo(()=>n?y.filter(s=>s.toLowerCase().includes(n.toLowerCase())):y,[n,y]);r.useEffect(()=>{p||(async()=>{g(!0),o("");const t=await J(j);if(t.success&&t.data.data){const l=t.data.data.parent_id;h({id:t.data.data._id,name:t.data.data.name,title:t.data.data.title,category:t.data.data.category,description:t.data.data.description,parent_id:l&&typeof l=="object"?l._id:l||null}),f(t.data.data.category)}else o(t.error||"Item not found");g(!1)})()},[j,p]);const m=r.useCallback(()=>{o(""),S("")},[]),w=r.useCallback(s=>{const{name:t,value:l}=s.target;if(t==="parent_id"){const i=c.find(d=>(d.id||d._id)===l);h(d=>({...d,parent_id:l===""?null:l,category:i?i.category:""})),f(i?i.category:"")}else h(i=>({...i,[t]:l})),t==="category"&&f(l);m()},[m,c]),T=r.useCallback(s=>{h(t=>({...t,description:s})),m()},[m]),R=r.useCallback(s=>{const t=s.target.value;f(t),h(l=>({...l,category:t})),x(!0),m()},[m]),A=r.useCallback(s=>{f(s),h(t=>({...t,category:s})),x(!1)},[]),M=r.useCallback(()=>{setTimeout(()=>x(!1),200)},[]),E=r.useCallback(()=>!a.name||!a.name.trim()?(o("Name is required"),!1):!a.title||!a.title.trim()?(o("Title is required"),!1):a.parent_id!==null&&(!a.category||!a.category.trim())||a.parent_id===null&&(!a.category||!a.category.trim())?(o("Category is required"),!1):!a.description||!a.description.trim()?(o("Description is required"),!1):!0,[a]),O=r.useCallback(async s=>{var t,l,i,d;if(s.preventDefault(),!!E()){g(!0),m();try{let u;p?u=await $(a):u=await z(a.id||a._id,a),u.success?(S(((t=u.data)==null?void 0:t.message)||"Item saved successfully!"),I.success(((l=u.data)==null?void 0:l.message)||"Item saved successfully!"),setTimeout(()=>b("/about"),1500)):(o(((i=u.data)==null?void 0:i.error)||"Failed to save item. Please try again."),I.error(((d=u.data)==null?void 0:d.error)||"Failed to save item. Please try again."),g(!1))}catch{o("Failed to save item. Please try again."),g(!1)}}},[a,E,m,b,p]),B=r.useCallback(()=>{b("/about")},[b]);return e.jsx(V,{children:e.jsx("div",{className:"edit-about-page",children:e.jsxs("div",{className:"edit-form-card",children:[e.jsxs("div",{className:"edit-form-header",children:[e.jsx("h1",{className:"edit-form-title",children:p?"Add New Item":"Edit Item"}),e.jsx("p",{className:"edit-form-subtitle",children:p?"Create a new about content item":`Editing: ${a.name||"Loading..."}`})]}),_&&e.jsx("div",{className:"error-banner",children:_}),k&&e.jsx("div",{className:"success-banner",children:k}),e.jsxs("form",{onSubmit:O,className:"edit-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",className:"form-label form-label-required",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",className:"form-input",placeholder:"Enter item name",value:a.name,onChange:w,required:!0}),e.jsx("p",{className:"form-help-text",children:"The English name/title of the item"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",className:"form-label form-label-required",children:"Title (Chinese)"}),e.jsx("input",{type:"text",id:"title",name:"title",className:"form-input",placeholder:"Enter Chinese title",value:a.title,onChange:w,required:!0}),e.jsx("p",{className:"form-help-text",children:"The Chinese title of the item"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",className:"form-label form-label-required",children:"Category"}),e.jsxs("div",{className:"category-input-wrapper",children:[e.jsx("input",{type:"text",id:"category",name:"category",className:"form-input",placeholder:"Type to search or create new category",value:n,onChange:R,onFocus:()=>x(!0),onBlur:M,required:!0,autoComplete:"off",disabled:a.parent_id!==null||c.length===0}),D&&a.parent_id===null&&e.jsxs("div",{className:"category-dropdown",children:[C.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"category-dropdown-label",children:"Existing Categories:"}),C.map(s=>e.jsx("div",{className:"category-dropdown-item",onClick:()=>A(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))]}):null,n&&!y.includes(n.toLowerCase())&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"category-dropdown-label",children:"Create New:"}),e.jsx("div",{className:"category-dropdown-item category-create-new",onClick:()=>A(n.toLowerCase()),children:e.jsxs("strong",{children:['+ Create "',n,'"']})})]}),C.length===0&&!n&&e.jsx("div",{className:"category-dropdown-empty",children:"No categories available"})]})]}),a.parent_id!==null?e.jsx("p",{className:"form-help-text",children:"Category is set by parent item."}):e.jsx("p",{className:"form-help-text",children:"Type to search existing categories or create a new one"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"parent_id",className:"form-label",children:"Parent Item (Optional)"}),e.jsxs("select",{id:"parent_id",name:"parent_id",className:"form-select",value:a.parent_id||"",onChange:w,disabled:c.length===0,children:[e.jsx("option",{value:"",children:"None (Top Level)"}),P.map(s=>e.jsx("option",{value:s.id||s._id,children:s.name},s.id||s._id))]}),a.parent_id!==null&&e.jsxs("div",{className:"selected-parent-name",children:[e.jsx("strong",{children:"Selected Parent:"})," ",(()=>{const s=c.find(t=>(t.id||t._id)===a.parent_id);return s?s.name:""})()]}),e.jsx("p",{className:"form-help-text",children:"Select a parent if this is a sub-item"})]})]}),e.jsxs("div",{className:"form-group form-group-full",children:[e.jsx("label",{htmlFor:"description",className:"form-label form-label-required",children:"Description"}),e.jsx("div",{className:"editor-wrapper",children:e.jsx(Q,{theme:"snow",value:a.description||"",onChange:T,modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["blockquote","code-block"],[{indent:"-1"},{indent:"+1"}],["clean"]]},formats:["header","bold","italic","underline","strike","color","background","list","bullet","align","link","image","blockquote","code-block","indent"],style:{height:"300px"}})}),e.jsx("p",{className:"form-help-text",children:"Use the toolbar to format text, add links, tables, and more."}),a.description&&a.description.trim()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"preview-toggle",onClick:()=>F(!N),children:N?"Hide Preview":"Show Preview"}),N&&e.jsx("div",{className:"html-preview",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:a.description}})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:B,disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-save",disabled:v,children:v?"Saving...":"Save Changes"})]})]})]})})})};export{ee as default};
